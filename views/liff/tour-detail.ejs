<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - é€€ä¼‘ç¦éŸ³</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .gradient-header { background: linear-gradient(135deg, #E74C3C 0%, #C0392B 100%); }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <div class="gradient-header text-white p-4 sticky top-0 z-10">
        <h1 class="text-xl font-bold">ğŸŒ <%= tour.name %></h1>
        <p class="text-sm opacity-90">ğŸ·ï¸ <%= tour.source %></p>
    </div>

    <!-- Content -->
    <div class="p-4 pb-24">
        <!-- åŸºæœ¬è³‡è¨Š -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-500">ğŸ“ åœ‹å®¶</span>
                <span class="font-bold"><%= tour.country %></span>
            </div>
            <div class="flex justify-between items-center mb-2">
                <span class="text-gray-500">ğŸ“† å¤©æ•¸</span>
                <span class="font-bold"><%= tour.days %> å¤©</span>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-gray-500">ğŸ’° é ç®—</span>
                <span class="font-bold text-red-500">$<%= tour.estimatedCostMin || 30000 %> - $<%= tour.estimatedCostMax || 50000 %></span>
            </div>
        </div>

        <!-- äº®é» -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <h2 class="text-lg font-bold text-red-500 mb-3">âœ¨ è¡Œç¨‹äº®é»</h2>
            <div class="flex flex-wrap gap-2">
                <% (tour.highlights || []).forEach(function(h) { %>
                    <span class="bg-red-100 text-red-600 px-3 py-1 rounded-full text-sm"><%= h %></span>
                <% }); %>
            </div>
        </div>

        <!-- æ¯æ—¥è¡Œç¨‹ -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <h2 class="text-lg font-bold text-red-500 mb-3">ğŸ“‹ æ¯æ—¥è¡Œç¨‹</h2>
            <% (tour.itinerary || []).forEach(function(day) { %>
                <div class="mb-4 pb-4 border-b last:border-b-0">
                    <h3 class="font-bold text-blue-600 mb-2">ğŸ“… Day <%= day.day %>: <%= day.title %></h3>
                    <ul class="ml-4">
                        <% (day.activities || []).forEach(function(act) { %>
                            <li class="text-gray-600 mb-1">â€¢ <%= act %></li>
                        <% }); %>
                    </ul>
                </div>
            <% }); %>
        </div>

        <!-- æé†’ -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <h2 class="text-lg font-bold text-red-500 mb-3">ğŸ’¡ æ—…éŠæé†’</h2>
            <ul>
                <% (tour.tips || []).forEach(function(tip) { %>
                    <li class="text-gray-600 mb-2">â€¢ <%= tip %></li>
                <% }); %>
            </ul>
        </div>

        <!-- æœ€ä½³å­£ç¯€ -->
        <div class="bg-white rounded-lg shadow p-4 mb-4">
            <div class="flex justify-between items-center">
                <span class="text-gray-500">ğŸ—“ï¸ æœ€ä½³å­£ç¯€</span>
                <span class="font-bold"><%= tour.bestSeason || 'å…¨å¹´çš†å®œ' %></span>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨æŒ‰éˆ• -->
    <div class="fixed bottom-0 left-0 right-0 bg-white shadow-lg p-4 flex gap-2">
        <button onclick="shareTour()" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-bold">
            ğŸ“¤ åˆ†äº«çµ¦å¥½å‹
        </button>
        <button onclick="downloadPDF()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold">
            ğŸ“„ ä¸‹è¼‰ PDF
        </button>
    </div>

    <script>
        var tourData = <%- JSON.stringify(tour) %>;
        var liffId = '<%= liffId %>';

        // åˆå§‹åŒ– LIFF
        liff.init({ liffId: liffId }).then(function() {
            console.log('LIFF initialized');
        }).catch(function(err) {
            console.error('LIFF init error:', err);
        });

        // åˆ†äº«è¡Œç¨‹
        function shareTour() {
            if (liff.isApiAvailable('shareTargetPicker')) {
                liff.shareTargetPicker([{
                    type: 'text',
                    text: 'ğŸŒ æ¨è–¦è¡Œç¨‹ï¼š' + tourData.name + '\n' +
                          'ğŸ“ ' + tourData.country + ' ' + tourData.days + 'å¤©\n' +
                          'ğŸ’° é ç®— $' + (tourData.estimatedCostMin || 30000) + '-$' + (tourData.estimatedCostMax || 50000) + '\n\n' +
                          'âœ¨ äº®é»ï¼š' + (tourData.highlights || []).slice(0, 3).join('ã€') + '\n\n' +
                          'åŠ å…¥é€€ä¼‘ç¦éŸ³è®“AIå¹«ä½ è¦åŠƒè¡Œç¨‹ï¼\n' +
                          'https://line.me/R/ti/p/@024wclps'
                }]).then(function(res) {
                    if (res) {
                        alert('åˆ†äº«æˆåŠŸï¼');
                    }
                }).catch(function(err) {
                    console.error('Share error:', err);
                });
            } else {
                alert('æ­¤åŠŸèƒ½éœ€è¦åœ¨ LINE å…§é–‹å•Ÿ');
            }
        }

        // ä¸‹è¼‰ PDF
        function downloadPDF() {
            window.location.href = '/api/tour/' + tourData.id + '/pdf';
        }
    </script>
</body>
</html>