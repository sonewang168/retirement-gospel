<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é€€ä¼‘ç¦éŸ³ - ç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é€€ä¼‘ç¦éŸ³">
    <meta name="theme-color" content="#E74C3C">
    <link rel="apple-touch-icon" href="https://fakeimg.pl/192x192/E74C3C/fff/?text=ğŸŒ…&font_size=100">
    
    <style>
        body { 
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        * { outline: none; }
        @media (display-mode: standalone) {
            .pwa-hint { display: none !important; }
        }
        .stats-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .stats-card:active {
            transform: scale(0.98);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
        }
        .detail-card {
            background: #f9fafb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border-left: 4px solid #3498db;
        }
        .detail-card:hover {
            background: #f3f4f6;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            color: #6b7280;
            font-size: 12px;
        }
        .detail-value {
            color: #111827;
            font-size: 12px;
            font-weight: 500;
        }
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-blue { background: #dbeafe; color: #1e40af; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-purple { background: #ede9fe; color: #5b21b6; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸŒ… é€€ä¼‘ç¦éŸ³</h1>
            <div class="text-sm" id="currentTime"></div>
        </div>
    </nav>

    <!-- PWA å®‰è£æç¤º -->
    <div class="pwa-hint bg-blue-100 text-blue-800 p-3 text-center text-sm">
        ğŸ“± Safariï¼šé»ã€Œåˆ†äº«ã€â†’ã€ŒåŠ å…¥ä¸»ç•«é¢ã€å¯åƒ APP ä½¿ç”¨
    </div>

    <div class="container mx-auto p-4">
        <!-- çµ±è¨ˆå¡ç‰‡ï¼ˆå¯é»æ“Šï¼‰ -->
        <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6">
            <div class="stats-card bg-white rounded-xl shadow p-4 border-l-4 border-blue-500" onclick="showUsers()">
                <p class="text-gray-500 text-xs">ç”¨æˆ¶æ•¸</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.users %></p>
                <p class="text-lg">ğŸ‘¥</p>
                <p class="text-xs text-blue-500 mt-1">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</p>
            </div>
            <div class="stats-card bg-white rounded-xl shadow p-4 border-l-4 border-green-500" onclick="showActivities()">
                <p class="text-gray-500 text-xs">æ´»å‹•æ•¸</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.activities %></p>
                <p class="text-lg">ğŸ¯</p>
                <p class="text-xs text-green-500 mt-1">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</p>
            </div>
            <div class="stats-card bg-white rounded-xl shadow p-4 border-l-4 border-yellow-500" onclick="showTours()">
                <p class="text-gray-500 text-xs">AIè¡Œç¨‹</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.tours %></p>
                <p class="text-lg">ğŸŒ</p>
                <p class="text-xs text-yellow-500 mt-1">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</p>
            </div>
            <div class="stats-card bg-white rounded-xl shadow p-4 border-l-4 border-purple-500" onclick="showReminders()">
                <p class="text-gray-500 text-xs">å¥åº·æé†’</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.reminders %></p>
                <p class="text-lg">ğŸ’Š</p>
                <p class="text-xs text-purple-500 mt-1">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</p>
            </div>
            <div class="stats-card bg-white rounded-xl shadow p-4 border-l-4 border-pink-500" onclick="showWishlists()">
                <p class="text-gray-500 text-xs">æƒ³å»æ”¶è—</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.wishlists %></p>
                <p class="text-lg">â¤ï¸</p>
                <p class="text-xs text-pink-500 mt-1">é»æ“ŠæŸ¥çœ‹è©³æƒ… â†’</p>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">âš¡ å¿«é€Ÿæ“ä½œ</h2>
            <div class="grid grid-cols-3 md:grid-cols-5 gap-2">
                <button onclick="refreshStats()" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ”„ é‡æ•´
                </button>
                <button onclick="syncDatabase()" class="bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ—„ï¸ åŒæ­¥
                </button>
                <button onclick="seedData()" class="bg-yellow-500 hover:bg-yellow-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ“¦ åŒ¯å…¥
                </button>
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg text-sm text-center transition">
                    ğŸ’¬ LINE
                </a>
                <a href="/" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-lg text-sm text-center transition">
                    ğŸ  é¦–é 
                </a>
            </div>
        </div>

        <!-- åŠŸèƒ½ç‹€æ…‹ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">âœ… åŠŸèƒ½ç‹€æ…‹</h2>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>ğŸŒ AIè¡Œç¨‹è¦åŠƒ</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â˜ï¸ å¤©æ°£æœå‹™</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>ğŸ’Š å¥åº·æé†’</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â¤ï¸ æƒ³å»æ”¶è—</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>âš™ï¸ å€‹äººè¨­å®š</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â° æ—©å®‰æ¨æ’­</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
            </div>
        </div>

        <!-- æœ€è¿‘ç”¨æˆ¶ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ‘¥ æœ€è¿‘ç”¨æˆ¶</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b bg-gray-50">
                            <th class="text-left p-2">åç¨±</th>
                            <th class="text-left p-2">åŸå¸‚</th>
                            <th class="text-left p-2">åŠ å…¥æ™‚é–“</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% recentUsers.forEach(function(user) { %>
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-2"><%= user.displayName || 'ç”¨æˆ¶' %></td>
                            <td class="p-2"><%= user.city || 'æœªè¨­å®š' %></td>
                            <td class="p-2"><%= new Date(user.createdAt).toLocaleDateString('zh-TW') %></td>
                        </tr>
                        <% }); %>
                        <% if (recentUsers.length === 0) { %>
                        <tr><td colspan="3" class="p-4 text-center text-gray-500">å°šç„¡ç”¨æˆ¶</td></tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- API é€£çµ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ”— API é€£çµ</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <a href="/api/stats" target="_blank" class="bg-blue-100 hover:bg-blue-200 text-blue-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ“Š çµ±è¨ˆ
                </a>
                <a href="/api/activities" target="_blank" class="bg-green-100 hover:bg-green-200 text-green-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ¯ æ´»å‹•
                </a>
                <a href="/api/health" target="_blank" class="bg-purple-100 hover:bg-purple-200 text-purple-800 p-3 rounded-lg text-sm text-center transition">
                    â¤ï¸ å¥åº·æª¢æŸ¥
                </a>
                <a href="/api/fix-db" target="_blank" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ—„ï¸ åŒæ­¥DB
                </a>
            </div>
        </div>

        <!-- LINE Bot è³‡è¨Š -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4 text-center">ğŸ’¬ LINE Bot</h2>
            <div class="flex flex-col items-center gap-4">
                <img src="https://qr-official.line.me/gs/M_024wclps_BW.png" alt="QR Code" class="w-40 h-40 border-4 border-green-500 rounded-lg shadow">
                <p class="text-gray-600 font-bold text-xl">@024wclps</p>
                <p class="text-gray-500 text-sm">æƒæ QR Code æˆ–æœå°‹ ID åŠ å…¥å¥½å‹</p>
                <div class="flex gap-3">
                    <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold transition">
                        ğŸ’¬ é–‹å•Ÿ LINE
                    </a>
                    <button onclick="copyLink()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition">
                        ğŸ“‹ è¤‡è£½é€£çµ
                    </button>
                </div>
            </div>
        </div>

        <!-- æ“ä½œæ—¥èªŒ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ“œ æ“ä½œæ—¥èªŒ</h2>
            <div id="logContainer" class="bg-gray-900 text-green-400 p-3 rounded-lg font-mono text-xs h-32 overflow-y-auto">
                <div>[ç³»çµ±] ç®¡ç†å¾Œå°å·²è¼‰å…¥</div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <footer class="bg-gray-800 text-white text-center p-4">
        <p class="text-sm">ğŸŒ… é€€ä¼‘ç¦éŸ³ Â© 2025</p>
        <p class="text-xs text-gray-400 mt-1">
            LINE Bot <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="text-green-400 hover:underline">@024wclps</a>
        </p>
    </footer>

    <!-- Modal å½ˆçª— -->
    <div id="modal" class="modal" onclick="closeModal(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="p-4 border-b flex justify-between items-center sticky top-0 bg-white rounded-t-2xl">
                <h3 id="modalTitle" class="text-lg font-bold">æ¨™é¡Œ</h3>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-2xl w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100">&times;</button>
            </div>
            <div id="modalBody" class="p-4">
                è¼‰å…¥ä¸­...
            </div>
        </div>
    </div>

    <script>
        // æ›´æ–°æ™‚é–“
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('zh-TW');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // æ—¥èªŒ
        function addLog(msg) {
            var c = document.getElementById('logContainer');
            var d = document.createElement('div');
            d.textContent = '[' + new Date().toLocaleTimeString('zh-TW') + '] ' + msg;
            c.appendChild(d);
            c.scrollTop = c.scrollHeight;
        }

        // Modal æ§åˆ¶
        function openModal(title, content) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('modal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(e) {
            if (!e || e.target.id === 'modal') {
                document.getElementById('modal').classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            var d = new Date(dateStr);
            return d.toLocaleDateString('zh-TW') + ' ' + d.toLocaleTimeString('zh-TW', {hour: '2-digit', minute: '2-digit'});
        }

        // ============================================
        // ğŸ‘¥ ç”¨æˆ¶åˆ—è¡¨ï¼ˆè©³ç´°ç‰ˆï¼‰
        // ============================================
        async function showUsers() {
            addLog('è¼‰å…¥ç”¨æˆ¶åˆ—è¡¨...');
            openModal('ğŸ‘¥ ç”¨æˆ¶åˆ—è¡¨', '<div class="text-center py-8"><div class="animate-spin text-4xl">â³</div><p class="text-gray-500 mt-2">è¼‰å…¥ä¸­...</p></div>');
            try {
                var r = await fetch('/api/admin/users');
                var d = await r.json();
                var html = '';
                
                if (d.data && d.data.length > 0) {
                    d.data.forEach(function(u, i) {
                        html += '<div class="detail-card" style="border-left-color: #3498db;">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<div>';
                        html += '<p class="font-bold text-lg">' + (u.displayName || 'ç”¨æˆ¶ ' + (i+1)) + '</p>';
                        html += '<p class="text-xs text-gray-400">ID: ' + (u.lineUserId ? u.lineUserId.substring(0,10) + '...' : '-') + '</p>';
                        html += '</div>';
                        html += '<span class="badge ' + (u.notificationEnabled ? 'badge-green' : 'badge-red') + '">' + (u.notificationEnabled ? 'ğŸ”” æ¨æ’­é–‹å•Ÿ' : 'ğŸ”• æ¨æ’­é—œé–‰') + '</span>';
                        html += '</div>';
                        
                        html += '<div class="grid grid-cols-2 gap-2 text-sm mt-3">';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“ åŸå¸‚</span><span class="detail-value">' + (u.city || 'æœªè¨­å®š') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">â° æ—©å®‰æ™‚é–“</span><span class="detail-value">' + (u.morningPushTime || '06:00') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“… åŠ å…¥æ™‚é–“</span><span class="detail-value">' + formatDate(u.createdAt) + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ• æœ€å¾Œæ´»å‹•</span><span class="detail-value">' + formatDate(u.updatedAt) + '</span></div>';
                        html += '</div>';
                        
                        if (u.interests && u.interests.length > 0) {
                            html += '<div class="mt-2"><span class="detail-label">èˆˆè¶£ï¼š</span>';
                            u.interests.forEach(function(int) {
                                html += '<span class="badge badge-blue mr-1">' + int + '</span>';
                            });
                            html += '</div>';
                        }
                        html += '</div>';
                    });
                } else {
                    html = '<div class="text-center py-8 text-gray-500">ğŸ˜¢ å°šç„¡ç”¨æˆ¶</div>';
                }
                
                openModal('ğŸ‘¥ ç”¨æˆ¶åˆ—è¡¨ï¼ˆ' + (d.data ? d.data.length : 0) + ' äººï¼‰', html);
                addLog('ç”¨æˆ¶åˆ—è¡¨è¼‰å…¥å®Œæˆ');
            } catch (e) {
                openModal('ğŸ‘¥ ç”¨æˆ¶åˆ—è¡¨', '<div class="text-center py-8 text-red-500">âŒ è¼‰å…¥å¤±æ•—ï¼š' + e.message + '</div>');
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // ============================================
        // ğŸ¯ æ´»å‹•åˆ—è¡¨ï¼ˆè©³ç´°ç‰ˆï¼‰
        // ============================================
        async function showActivities() {
            addLog('è¼‰å…¥æ´»å‹•åˆ—è¡¨...');
            openModal('ğŸ¯ æ´»å‹•åˆ—è¡¨', '<div class="text-center py-8"><div class="animate-spin text-4xl">â³</div><p class="text-gray-500 mt-2">è¼‰å…¥ä¸­...</p></div>');
            try {
                var r = await fetch('/api/activities?limit=50');
                var d = await r.json();
                var html = '';
                
                var categoryMap = {
                    'culture': 'ğŸ›ï¸ æ–‡åŒ–è—è¡“',
                    'nature': 'ğŸŒ³ è‡ªç„¶æ™¯è§€',
                    'religion': 'ğŸ™ å®—æ•™è–åœ°',
                    'food': 'ğŸœ ç¾é£Ÿå“åš',
                    'sports': 'ğŸ’ª é‹å‹•å¥èº«',
                    'entertainment': 'ğŸ­ ä¼‘é–’å¨›æ¨‚'
                };
                
                if (d.data && d.data.length > 0) {
                    d.data.forEach(function(a) {
                        html += '<div class="detail-card" style="border-left-color: #27ae60;">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<p class="font-bold text-lg">' + a.name + '</p>';
                        html += '<span class="badge badge-yellow">â­ ' + (a.rating || 4.5) + '</span>';
                        html += '</div>';
                        
                        html += '<div class="flex flex-wrap gap-1 mb-2">';
                        html += '<span class="badge badge-purple">' + (categoryMap[a.category] || a.category) + '</span>';
                        if (a.isActive) html += '<span class="badge badge-green">âœ“ å•Ÿç”¨ä¸­</span>';
                        html += '</div>';
                        
                        html += '<div class="text-sm space-y-1">';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“ åœ°é»</span><span class="detail-value">' + (a.city || '') + ' ' + (a.district || '') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ  åœ°å€</span><span class="detail-value">' + (a.address || '-') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ’° è²»ç”¨</span><span class="detail-value">' + (a.costMin || 0) + ' ~ ' + (a.costMax || 0) + ' å…ƒ</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">â±ï¸ å»ºè­°æ™‚é–“</span><span class="detail-value">' + (a.suggestedDuration || 60) + ' åˆ†é˜</span></div>';
                        html += '</div>';
                        
                        if (a.description) {
                            html += '<p class="text-xs text-gray-500 mt-2 line-clamp-2">' + a.description.substring(0, 100) + (a.description.length > 100 ? '...' : '') + '</p>';
                        }
                        html += '</div>';
                    });
                } else {
                    html = '<div class="text-center py-8 text-gray-500">ğŸ˜¢ å°šç„¡æ´»å‹•</div>';
                }
                
                openModal('ğŸ¯ æ´»å‹•åˆ—è¡¨ï¼ˆå…± ' + (d.total || 0) + ' ç­†ï¼‰', html);
                addLog('æ´»å‹•åˆ—è¡¨è¼‰å…¥å®Œæˆ');
            } catch (e) {
                openModal('ğŸ¯ æ´»å‹•åˆ—è¡¨', '<div class="text-center py-8 text-red-500">âŒ è¼‰å…¥å¤±æ•—ï¼š' + e.message + '</div>');
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // ============================================
        // ğŸŒ AIè¡Œç¨‹ï¼ˆè©³ç´°ç‰ˆï¼‰
        // ============================================
        async function showTours() {
            addLog('è¼‰å…¥AIè¡Œç¨‹...');
            openModal('ğŸŒ AIè¡Œç¨‹', '<div class="text-center py-8"><div class="animate-spin text-4xl">â³</div><p class="text-gray-500 mt-2">è¼‰å…¥ä¸­...</p></div>');
            try {
                var r = await fetch('/api/admin/tours');
                var d = await r.json();
                var html = '';
                
                if (d.data && d.data.length > 0) {
                    d.data.forEach(function(t) {
                        html += '<div class="detail-card" style="border-left-color: #f39c12;">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<p class="font-bold text-lg">' + (t.name || 'è¡Œç¨‹') + '</p>';
                        html += '<span class="badge badge-yellow">ğŸ“… ' + (t.days || 5) + ' å¤©</span>';
                        html += '</div>';
                        
                        html += '<div class="text-sm space-y-1">';
                        html += '<div class="detail-row"><span class="detail-label">ğŸŒ ç›®çš„åœ°</span><span class="detail-value">' + (t.country || '-') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ¤– AIå¼•æ“</span><span class="detail-value">' + (t.aiProvider || 'ChatGPT') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“… å»ºç«‹æ™‚é–“</span><span class="detail-value">' + formatDate(t.createdAt) + '</span></div>';
                        html += '</div>';
                        
                        if (t.highlights && t.highlights.length > 0) {
                            html += '<div class="mt-2"><p class="detail-label mb-1">âœ¨ è¡Œç¨‹äº®é»ï¼š</p><div class="flex flex-wrap gap-1">';
                            var highlights = Array.isArray(t.highlights) ? t.highlights : [];
                            highlights.slice(0, 5).forEach(function(h) {
                                html += '<span class="badge badge-blue">' + h + '</span>';
                            });
                            html += '</div></div>';
                        }
                        
                        if (t.content) {
                            html += '<div class="mt-2 p-2 bg-gray-100 rounded text-xs text-gray-600 max-h-32 overflow-y-auto">';
                            html += '<p class="detail-label mb-1">ğŸ“ è¡Œç¨‹å…§å®¹ï¼š</p>';
                            html += '<pre class="whitespace-pre-wrap">' + t.content.substring(0, 500) + (t.content.length > 500 ? '...' : '') + '</pre>';
                            html += '</div>';
                        }
                        html += '</div>';
                    });
                } else {
                    html = '<div class="text-center py-8 text-gray-500">ğŸ˜¢ å°šç„¡AIè¡Œç¨‹<br><span class="text-sm">åœ¨ LINE Bot è¼¸å…¥ã€Œæ—¥æœ¬5å¤©ã€è©¦è©¦ï¼</span></div>';
                }
                
                openModal('ğŸŒ AIè¡Œç¨‹ï¼ˆ' + (d.data ? d.data.length : 0) + ' ç­†ï¼‰', html);
                addLog('AIè¡Œç¨‹è¼‰å…¥å®Œæˆ');
            } catch (e) {
                openModal('ğŸŒ AIè¡Œç¨‹', '<div class="text-center py-8 text-red-500">âŒ è¼‰å…¥å¤±æ•—ï¼š' + e.message + '</div>');
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // ============================================
        // ğŸ’Š å¥åº·æé†’ï¼ˆè©³ç´°ç‰ˆï¼‰
        // ============================================
        async function showReminders() {
            addLog('è¼‰å…¥å¥åº·æé†’...');
            openModal('ğŸ’Š å¥åº·æé†’', '<div class="text-center py-8"><div class="animate-spin text-4xl">â³</div><p class="text-gray-500 mt-2">è¼‰å…¥ä¸­...</p></div>');
            try {
                var r = await fetch('/api/admin/reminders');
                var d = await r.json();
                var html = '';
                
                if (d.data && d.data.length > 0) {
                    d.data.forEach(function(h) {
                        var isAppointment = h.type === 'appointment';
                        var icon = isAppointment ? 'ğŸ¥' : 'ğŸ’Š';
                        var color = isAppointment ? '#9b59b6' : '#e74c3c';
                        
                        html += '<div class="detail-card" style="border-left-color: ' + color + ';">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<p class="font-bold text-lg">' + icon + ' ' + (isAppointment ? 'å›è¨ºæé†’' : 'ç”¨è—¥æé†’') + '</p>';
                        html += '<span class="badge ' + (h.isActive ? 'badge-green' : 'badge-red') + '">' + (h.isActive ? 'âœ“ å•Ÿç”¨' : 'âœ— åœç”¨') + '</span>';
                        html += '</div>';
                        
                        html += '<div class="text-sm space-y-1">';
                        if (isAppointment) {
                            html += '<div class="detail-row"><span class="detail-label">ğŸ¥ é†«é™¢</span><span class="detail-value">' + (h.hospitalName || '-') + '</span></div>';
                            html += '<div class="detail-row"><span class="detail-label">ğŸ©º ç§‘åˆ¥</span><span class="detail-value">' + (h.department || '-') + '</span></div>';
                            html += '<div class="detail-row"><span class="detail-label">ğŸ“… å›è¨ºæ—¥æœŸ</span><span class="detail-value">' + (h.appointmentDate || '-') + '</span></div>';
                            html += '<div class="detail-row"><span class="detail-label">â° å›è¨ºæ™‚é–“</span><span class="detail-value">' + (h.appointmentTime || '-') + '</span></div>';
                        } else {
                            html += '<div class="detail-row"><span class="detail-label">ğŸ’Š è—¥å</span><span class="detail-value">' + (h.medicationName || '-') + '</span></div>';
                            html += '<div class="detail-row"><span class="detail-label">ğŸ“Š åŠ‘é‡</span><span class="detail-value">' + (h.dosage || '-') + '</span></div>';
                            if (h.reminderTimes && h.reminderTimes.length > 0) {
                                html += '<div class="detail-row"><span class="detail-label">â° æé†’æ™‚é–“</span><span class="detail-value">' + h.reminderTimes.join(', ') + '</span></div>';
                            }
                        }
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“… å»ºç«‹æ™‚é–“</span><span class="detail-value">' + formatDate(h.createdAt) + '</span></div>';
                        html += '</div>';
                        
                        if (h.note) {
                            html += '<p class="text-xs text-gray-500 mt-2">ğŸ“ å‚™è¨»ï¼š' + h.note + '</p>';
                        }
                        html += '</div>';
                    });
                } else {
                    html = '<div class="text-center py-8 text-gray-500">ğŸ˜¢ å°šç„¡å¥åº·æé†’<br><span class="text-sm">åœ¨ LINE Bot è¼¸å…¥ã€Œå¥åº·ã€è¨­å®šæé†’ï¼</span></div>';
                }
                
                openModal('ğŸ’Š å¥åº·æé†’ï¼ˆ' + (d.data ? d.data.length : 0) + ' ç­†ï¼‰', html);
                addLog('å¥åº·æé†’è¼‰å…¥å®Œæˆ');
            } catch (e) {
                openModal('ğŸ’Š å¥åº·æé†’', '<div class="text-center py-8 text-red-500">âŒ è¼‰å…¥å¤±æ•—ï¼š' + e.message + '</div>');
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // ============================================
        // â¤ï¸ æƒ³å»æ”¶è—ï¼ˆè©³ç´°ç‰ˆï¼‰
        // ============================================
        async function showWishlists() {
            addLog('è¼‰å…¥æƒ³å»æ”¶è—...');
            openModal('â¤ï¸ æƒ³å»æ”¶è—', '<div class="text-center py-8"><div class="animate-spin text-4xl">â³</div><p class="text-gray-500 mt-2">è¼‰å…¥ä¸­...</p></div>');
            try {
                var r = await fetch('/api/admin/wishlists');
                var d = await r.json();
                var html = '';
                
                if (d.data && d.data.length > 0) {
                    d.data.forEach(function(w) {
                        var a = w.Activity || {};
                        html += '<div class="detail-card" style="border-left-color: #e91e63;">';
                        html += '<div class="flex justify-between items-start mb-2">';
                        html += '<p class="font-bold text-lg">' + (a.name || 'æ´»å‹•') + '</p>';
                        html += '<span class="badge ' + (w.isVisited ? 'badge-green' : 'badge-blue') + '">' + (w.isVisited ? 'âœ… å·²å»é' : 'ğŸ“ æƒ³å»') + '</span>';
                        html += '</div>';
                        
                        html += '<div class="text-sm space-y-1">';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“ åœ°é»</span><span class="detail-value">' + (a.city || '') + ' ' + (a.district || '') + '</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">â­ è©•åˆ†</span><span class="detail-value">' + (a.rating || 4.5) + ' åˆ†</span></div>';
                        html += '<div class="detail-row"><span class="detail-label">ğŸ“… æ”¶è—æ™‚é–“</span><span class="detail-value">' + formatDate(w.createdAt) + '</span></div>';
                        if (w.isVisited && w.visitedAt) {
                            html += '<div class="detail-row"><span class="detail-label">âœ… å»éæ™‚é–“</span><span class="detail-value">' + formatDate(w.visitedAt) + '</span></div>';
                        }
                        html += '</div>';
                        
                        if (w.note) {
                            html += '<p class="text-xs text-gray-500 mt-2">ğŸ“ å‚™è¨»ï¼š' + w.note + '</p>';
                        }
                        html += '</div>';
                    });
                } else {
                    html = '<div class="text-center py-8 text-gray-500">ğŸ˜¢ å°šç„¡æ”¶è—<br><span class="text-sm">åœ¨ LINE Bot è¼¸å…¥ã€Œæ‰¾æ´»å‹•ã€é–‹å§‹æ¢ç´¢ï¼</span></div>';
                }
                
                openModal('â¤ï¸ æƒ³å»æ”¶è—ï¼ˆ' + (d.data ? d.data.length : 0) + ' ç­†ï¼‰', html);
                addLog('æƒ³å»æ”¶è—è¼‰å…¥å®Œæˆ');
            } catch (e) {
                openModal('â¤ï¸ æƒ³å»æ”¶è—', '<div class="text-center py-8 text-red-500">âŒ è¼‰å…¥å¤±æ•—ï¼š' + e.message + '</div>');
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // ============================================
        // å…¶ä»–åŠŸèƒ½
        // ============================================
        function refreshStats() {
            addLog('æ­£åœ¨é‡æ–°æ•´ç†...');
            location.reload();
        }

        async function syncDatabase() {
            addLog('æ­£åœ¨åŒæ­¥è³‡æ–™åº«...');
            try {
                var r = await fetch('/api/fix-db');
                var d = await r.json();
                addLog(d.message || 'åŒæ­¥å®Œæˆ');
                alert(d.message || 'åŒæ­¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        async function seedData() {
            if (!confirm('ç¢ºå®šè¦é‡æ–°åŒ¯å…¥ç¨®å­è³‡æ–™ï¼Ÿ')) return;
            addLog('æ­£åœ¨åŒ¯å…¥ç¨®å­è³‡æ–™...');
            try {
                var r = await fetch('/api/seed?force=true');
                var d = await r.json();
                addLog(d.message || 'åŒ¯å…¥å®Œæˆ');
                alert(d.message || 'åŒ¯å…¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        function copyLink() {
            navigator.clipboard.writeText('https://line.me/R/ti/p/@024wclps').then(function() {
                addLog('é€£çµå·²è¤‡è£½');
                alert('é€£çµå·²è¤‡è£½ï¼');
            });
        }

        // PWA æª¢æ¸¬
        if (window.matchMedia('(display-mode: standalone)').matches) {
            var hint = document.querySelector('.pwa-hint');
            if (hint) hint.style.display = 'none';
        }

        addLog('çµ±è¨ˆè³‡æ–™å·²è¼‰å…¥');
    </script>
</body>
</html>