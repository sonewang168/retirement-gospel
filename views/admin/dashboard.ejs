<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€€ä¼‘ç¦éŸ³ - ç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <nav class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold">ğŸŒ… é€€ä¼‘ç¦éŸ³ç®¡ç†å¾Œå°</h1>
            <div class="text-sm" id="currentTime"></div>
        </div>
    </nav>

    <div class="container mx-auto p-6">
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">ç¸½ç”¨æˆ¶æ•¸</p>
                        <p class="text-3xl font-bold text-gray-800"><%= stats.users %></p>
                    </div>
                    <div class="text-4xl">ğŸ‘¥</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">æ´»å‹•æ•¸é‡</p>
                        <p class="text-3xl font-bold text-gray-800"><%= stats.activities %></p>
                    </div>
                    <div class="text-4xl">ğŸ¯</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">AIè¡Œç¨‹æ•¸</p>
                        <p class="text-3xl font-bold text-gray-800"><%= stats.tours %></p>
                    </div>
                    <div class="text-4xl">ğŸŒ</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">å¥åº·æé†’</p>
                        <p class="text-3xl font-bold text-gray-800"><%= stats.reminders %></p>
                    </div>
                    <div class="text-4xl">ğŸ’Š</div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-pink-500">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-gray-500 text-sm">æƒ³å»æ”¶è—</p>
                        <p class="text-3xl font-bold text-gray-800"><%= stats.wishlists %></p>
                    </div>
                    <div class="text-4xl">â¤ï¸</div>
                </div>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">âš¡ å¿«é€Ÿæ“ä½œ</h2>
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <button onclick="refreshStats()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition flex items-center justify-center">
                    ğŸ”„ é‡æ–°æ•´ç†
                </button>
                <button onclick="syncDatabase()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition flex items-center justify-center">
                    ğŸ—„ï¸ åŒæ­¥è³‡æ–™åº«
                </button>
                <button onclick="seedData()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-3 rounded-lg transition flex items-center justify-center">
                    ğŸ“¦ åŒ¯å…¥è³‡æ–™
                </button>
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg transition flex items-center justify-center">
                    ğŸ’¬ LINE Bot
                </a>
                <a href="/" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg transition flex items-center justify-center">
                    ğŸ  è¿”å›é¦–é 
                </a>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- åŠŸèƒ½ç‹€æ…‹ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">âœ… åŠŸèƒ½ç‹€æ…‹</h2>
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>ğŸŒ AI è¡Œç¨‹è¦åŠƒï¼ˆChatGPT + Geminiï¼‰</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>â˜ï¸ å¤©æ°£æœå‹™ï¼ˆ200+ åŸå¸‚ï¼‰</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>ğŸ’Š å¥åº·æé†’ï¼ˆå›è¨º/ç”¨è—¥ï¼‰</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>â¤ï¸ æƒ³å»æ¸…å–®æ”¶è—</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>âš™ï¸ å€‹äººè¨­å®šç®¡ç†</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span>â° æ—©å®‰æ¨æ’­æ’ç¨‹</span>
                        <span class="text-green-500 font-bold">é‹ä½œä¸­</span>
                    </div>
                </div>
            </div>

            <!-- æœ€è¿‘ç”¨æˆ¶ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘¥ æœ€è¿‘ç”¨æˆ¶</h2>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead>
                            <tr class="border-b">
                                <th class="text-left p-2">åç¨±</th>
                                <th class="text-left p-2">åŸå¸‚</th>
                                <th class="text-left p-2">åŠ å…¥æ™‚é–“</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% recentUsers.forEach(function(user) { %>
                            <tr class="border-b hover:bg-gray-50">
                                <td class="p-2"><%= user.displayName || 'ç”¨æˆ¶' %></td>
                                <td class="p-2"><%= user.city || 'æœªè¨­å®š' %></td>
                                <td class="p-2"><%= new Date(user.createdAt).toLocaleDateString('zh-TW') %></td>
                            </tr>
                            <% }); %>
                            <% if (recentUsers.length === 0) { %>
                            <tr><td colspan="3" class="p-4 text-center text-gray-500">å°šç„¡ç”¨æˆ¶</td></tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- API é€£çµ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ”— API é€£çµ</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="/api/stats" target="_blank" class="block bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-3 rounded-lg transition text-center">
                    ğŸ“Š çµ±è¨ˆè³‡æ–™
                </a>
                <a href="/api/activities" target="_blank" class="block bg-green-100 hover:bg-green-200 text-green-800 px-4 py-3 rounded-lg transition text-center">
                    ğŸ¯ æ´»å‹•åˆ—è¡¨
                </a>
                <a href="/api/health" target="_blank" class="block bg-purple-100 hover:bg-purple-200 text-purple-800 px-4 py-3 rounded-lg transition text-center">
                    â¤ï¸ å¥åº·æª¢æŸ¥
                </a>
                <a href="/api/fix-db" target="_blank" class="block bg-yellow-100 hover:bg-yellow-200 text-yellow-800 px-4 py-3 rounded-lg transition text-center">
                    ğŸ—„ï¸ åŒæ­¥è³‡æ–™åº«
                </a>
            </div>
        </div>

        <!-- æ“ä½œæ—¥èªŒ -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“œ æ“ä½œæ—¥èªŒ</h2>
            <div id="logContainer" class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm h-48 overflow-y-auto">
                <div>[ç³»çµ±] ç®¡ç†å¾Œå°å·²è¼‰å…¥</div>
            </div>
        </div>
    </div>

    <!-- LINE Bot è³‡è¨Š -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
        <h2 class="text-xl font-bold text-gray-800 mb-4 text-center">ğŸ’¬ LINE Bot è³‡è¨Š</h2>
        <div class="flex flex-col items-center gap-4">
            <img src="https://qr-official.line.me/gs/M_024wclps_BW.png" alt="LINE QR Code" class="w-48 h-48 border-4 border-green-500 rounded-lg">
            <p class="text-gray-600 font-bold text-xl">@024wclps</p>
            <p class="text-gray-500 text-sm">æƒæ QR Code æˆ–æœå°‹ ID åŠ å…¥å¥½å‹</p>
            <div class="flex gap-3">
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition font-bold">
                    ğŸ’¬ é–‹å•Ÿ LINE Bot
                </a>
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition font-bold">
                    ğŸ“¤ åˆ†äº«é€£çµ
                </a>
            </div>
            <p class="text-sm text-gray-400">
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="hover:underline">https://line.me/R/ti/p/@024wclps</a>
            </p>
        </div>
    </div>

    <footer class="bg-gray-800 text-white text-center p-4 mt-8">
        <p>ğŸŒ… é€€ä¼‘ç¦éŸ³ Â© 2025 | LINE Bot <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="text-green-400 hover:underline">@024wclps</a></p>
    </footer>

    <script>
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('zh-TW');
        }
        setInterval(updateTime, 1000);
        updateTime();

        function addLog(msg) {
            var container = document.getElementById('logContainer');
            var div = document.createElement('div');
            div.textContent = '[' + new Date().toLocaleTimeString('zh-TW') + '] ' + msg;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        async function refreshStats() {
            addLog('æ­£åœ¨é‡æ–°æ•´ç†...');
            location.reload();
        }

        async function syncDatabase() {
            addLog('æ­£åœ¨åŒæ­¥è³‡æ–™åº«...');
            try {
                var res = await fetch('/api/fix-db');
                var data = await res.json();
                addLog(data.message || 'åŒæ­¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        async function seedData() {
            if (!confirm('ç¢ºå®šè¦é‡æ–°åŒ¯å…¥ç¨®å­è³‡æ–™ï¼Ÿ')) return;
            addLog('æ­£åœ¨åŒ¯å…¥ç¨®å­è³‡æ–™...');
            try {
                var res = await fetch('/api/seed?force=true');
                var data = await res.json();
                addLog(data.message || 'åŒ¯å…¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        addLog('çµ±è¨ˆè³‡æ–™å·²è¼‰å…¥');
    </script>
</body>
</html>