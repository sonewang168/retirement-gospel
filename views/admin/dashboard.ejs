<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é€€ä¼‘ç¦éŸ³ - ç®¡ç†å¾Œå°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA è¨­å®š -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é€€ä¼‘ç¦éŸ³">
    <meta name="theme-color" content="#E74C3C">
    <link rel="apple-touch-icon" href="https://fakeimg.pl/192x192/E74C3C/fff/?text=ğŸŒ…&font_size=100">
    
    <style>
        body { 
            -webkit-tap-highlight-color: transparent;
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
        }
        @media (display-mode: standalone) {
            .pwa-hint { display: none !important; }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- é ‚éƒ¨å°èˆª -->
    <nav class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold">ğŸŒ… é€€ä¼‘ç¦éŸ³</h1>
            <div class="text-sm" id="currentTime"></div>
        </div>
    </nav>

    <!-- PWA å®‰è£æç¤º -->
    <div class="pwa-hint bg-blue-100 text-blue-800 p-3 text-center text-sm">
        ğŸ“± Safariï¼šé»ã€Œåˆ†äº«ã€â†’ã€ŒåŠ å…¥ä¸»ç•«é¢ã€å¯åƒ APP ä½¿ç”¨
    </div>

    <div class="container mx-auto p-4">
        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-2 lg:grid-cols-5 gap-3 mb-6">
            <div class="bg-white rounded-xl shadow p-4 border-l-4 border-blue-500">
                <p class="text-gray-500 text-xs">ç”¨æˆ¶æ•¸</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.users %></p>
                <p class="text-lg">ğŸ‘¥</p>
            </div>
            <div class="bg-white rounded-xl shadow p-4 border-l-4 border-green-500">
                <p class="text-gray-500 text-xs">æ´»å‹•æ•¸</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.activities %></p>
                <p class="text-lg">ğŸ¯</p>
            </div>
            <div class="bg-white rounded-xl shadow p-4 border-l-4 border-yellow-500">
                <p class="text-gray-500 text-xs">AIè¡Œç¨‹</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.tours %></p>
                <p class="text-lg">ğŸŒ</p>
            </div>
            <div class="bg-white rounded-xl shadow p-4 border-l-4 border-purple-500">
                <p class="text-gray-500 text-xs">å¥åº·æé†’</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.reminders %></p>
                <p class="text-lg">ğŸ’Š</p>
            </div>
            <div class="bg-white rounded-xl shadow p-4 border-l-4 border-pink-500">
                <p class="text-gray-500 text-xs">æƒ³å»æ”¶è—</p>
                <p class="text-2xl font-bold text-gray-800"><%= stats.wishlists %></p>
                <p class="text-lg">â¤ï¸</p>
            </div>
        </div>

        <!-- å¿«é€Ÿæ“ä½œ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">âš¡ å¿«é€Ÿæ“ä½œ</h2>
            <div class="grid grid-cols-3 md:grid-cols-5 gap-2">
                <button onclick="refreshStats()" class="bg-blue-500 hover:bg-blue-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ”„ é‡æ•´
                </button>
                <button onclick="syncDatabase()" class="bg-green-500 hover:bg-green-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ—„ï¸ åŒæ­¥
                </button>
                <button onclick="seedData()" class="bg-yellow-500 hover:bg-yellow-600 text-white p-3 rounded-lg text-sm transition">
                    ğŸ“¦ åŒ¯å…¥
                </button>
                <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-600 hover:bg-green-700 text-white p-3 rounded-lg text-sm text-center transition">
                    ğŸ’¬ LINE
                </a>
                <a href="/" class="bg-gray-500 hover:bg-gray-600 text-white p-3 rounded-lg text-sm text-center transition">
                    ğŸ  é¦–é 
                </a>
            </div>
        </div>

        <!-- åŠŸèƒ½ç‹€æ…‹ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">âœ… åŠŸèƒ½ç‹€æ…‹</h2>
            <div class="grid grid-cols-2 gap-2 text-sm">
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>ğŸŒ AIè¡Œç¨‹è¦åŠƒ</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â˜ï¸ å¤©æ°£æœå‹™</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>ğŸ’Š å¥åº·æé†’</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â¤ï¸ æƒ³å»æ”¶è—</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>âš™ï¸ å€‹äººè¨­å®š</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
                <div class="flex items-center justify-between p-2 bg-green-50 rounded">
                    <span>â° æ—©å®‰æ¨æ’­</span>
                    <span class="text-green-500 font-bold">âœ“</span>
                </div>
            </div>
        </div>

        <!-- æœ€è¿‘ç”¨æˆ¶ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ‘¥ æœ€è¿‘ç”¨æˆ¶</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b bg-gray-50">
                            <th class="text-left p-2">åç¨±</th>
                            <th class="text-left p-2">åŸå¸‚</th>
                            <th class="text-left p-2">åŠ å…¥æ™‚é–“</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% recentUsers.forEach(function(user) { %>
                        <tr class="border-b hover:bg-gray-50">
                            <td class="p-2"><%= user.displayName || 'ç”¨æˆ¶' %></td>
                            <td class="p-2"><%= user.city || 'æœªè¨­å®š' %></td>
                            <td class="p-2"><%= new Date(user.createdAt).toLocaleDateString('zh-TW') %></td>
                        </tr>
                        <% }); %>
                        <% if (recentUsers.length === 0) { %>
                        <tr><td colspan="3" class="p-4 text-center text-gray-500">å°šç„¡ç”¨æˆ¶</td></tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- API é€£çµ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ”— API é€£çµ</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <a href="/api/stats" target="_blank" class="bg-blue-100 hover:bg-blue-200 text-blue-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ“Š çµ±è¨ˆ
                </a>
                <a href="/api/activities" target="_blank" class="bg-green-100 hover:bg-green-200 text-green-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ¯ æ´»å‹•
                </a>
                <a href="/api/health" target="_blank" class="bg-purple-100 hover:bg-purple-200 text-purple-800 p-3 rounded-lg text-sm text-center transition">
                    â¤ï¸ å¥åº·æª¢æŸ¥
                </a>
                <a href="/api/fix-db" target="_blank" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-800 p-3 rounded-lg text-sm text-center transition">
                    ğŸ—„ï¸ åŒæ­¥DB
                </a>
            </div>
        </div>

        <!-- LINE Bot è³‡è¨Š -->
        <div class="bg-white rounded-xl shadow p-6 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-4 text-center">ğŸ’¬ LINE Bot</h2>
            <div class="flex flex-col items-center gap-4">
                <img src="https://qr-official.line.me/gs/M_024wclps_BW.png" alt="QR Code" class="w-40 h-40 border-4 border-green-500 rounded-lg shadow">
                <p class="text-gray-600 font-bold text-xl">@024wclps</p>
                <p class="text-gray-500 text-sm">æƒæ QR Code æˆ–æœå°‹ ID åŠ å…¥å¥½å‹</p>
                <div class="flex gap-3">
                    <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold transition">
                        ğŸ’¬ é–‹å•Ÿ LINE
                    </a>
                    <button onclick="copyLink()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition">
                        ğŸ“‹ è¤‡è£½é€£çµ
                    </button>
                </div>
                <p class="text-xs text-gray-400" id="linkText">https://line.me/R/ti/p/@024wclps</p>
            </div>
        </div>

        <!-- æ“ä½œæ—¥èªŒ -->
        <div class="bg-white rounded-xl shadow p-4 mb-6">
            <h2 class="text-lg font-bold text-gray-800 mb-3">ğŸ“œ æ“ä½œæ—¥èªŒ</h2>
            <div id="logContainer" class="bg-gray-900 text-green-400 p-3 rounded-lg font-mono text-xs h-32 overflow-y-auto">
                <div>[ç³»çµ±] ç®¡ç†å¾Œå°å·²è¼‰å…¥</div>
            </div>
        </div>
    </div>

    <!-- åº•éƒ¨å°èˆª -->
    <footer class="bg-gray-800 text-white text-center p-4">
        <p class="text-sm">ğŸŒ… é€€ä¼‘ç¦éŸ³ Â© 2025</p>
        <p class="text-xs text-gray-400 mt-1">
            LINE Bot <a href="https://line.me/R/ti/p/@024wclps" target="_blank" class="text-green-400 hover:underline">@024wclps</a>
        </p>
    </footer>

    <script>
        // æ›´æ–°æ™‚é–“
        function updateTime() {
            document.getElementById('currentTime').textContent = new Date().toLocaleString('zh-TW');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // æ—¥èªŒ
        function addLog(msg) {
            var c = document.getElementById('logContainer');
            var d = document.createElement('div');
            d.textContent = '[' + new Date().toLocaleTimeString('zh-TW') + '] ' + msg;
            c.appendChild(d);
            c.scrollTop = c.scrollHeight;
        }

        // é‡æ–°æ•´ç†
        function refreshStats() {
            addLog('æ­£åœ¨é‡æ–°æ•´ç†...');
            location.reload();
        }

        // åŒæ­¥è³‡æ–™åº«
        async function syncDatabase() {
            addLog('æ­£åœ¨åŒæ­¥è³‡æ–™åº«...');
            try {
                var r = await fetch('/api/fix-db');
                var d = await r.json();
                addLog(d.message || 'åŒæ­¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // åŒ¯å…¥ç¨®å­è³‡æ–™
        async function seedData() {
            if (!confirm('ç¢ºå®šè¦é‡æ–°åŒ¯å…¥ç¨®å­è³‡æ–™ï¼Ÿé€™æœƒè¦†è“‹ç¾æœ‰æ´»å‹•è³‡æ–™ã€‚')) return;
            addLog('æ­£åœ¨åŒ¯å…¥ç¨®å­è³‡æ–™...');
            try {
                var r = await fetch('/api/seed?force=true');
                var d = await r.json();
                addLog(d.message || 'åŒ¯å…¥å®Œæˆ');
            } catch (e) {
                addLog('éŒ¯èª¤: ' + e.message);
            }
        }

        // è¤‡è£½é€£çµ
        function copyLink() {
            var link = 'https://line.me/R/ti/p/@024wclps';
            navigator.clipboard.writeText(link).then(function() {
                addLog('é€£çµå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
                alert('é€£çµå·²è¤‡è£½ï¼');
            }).catch(function() {
                addLog('è¤‡è£½å¤±æ•—');
            });
        }

        // PWA å®‰è£å¾Œéš±è—æç¤º
        if (window.matchMedia('(display-mode: standalone)').matches) {
            var hint = document.querySelector('.pwa-hint');
            if (hint) hint.style.display = 'none';
        }

        addLog('çµ±è¨ˆè³‡æ–™å·²è¼‰å…¥');
    </script>
</body>
</html>